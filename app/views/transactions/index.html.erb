<h1>KelloggCoin Ledger</h1>

<!-- Step 1: List all transactions, starting with the ICO -->
<ol>
  <% for transaction in Transaction.all %>
    <% from_user = User.find_by({ "id" => transaction["from_user_id"] }) %>
    <% to_user = User.find_by({ "id" => transaction["to_user_id"] }) %>

    <li>
      <% if from_user.nil? %>
        Initial coin offering: <%= transaction["amount"] %> to <%= to_user["name"] %>
      <% else %>
        <%= transaction["amount"] %> KC from <%= from_user["name"] %> to <%= to_user["name"] %>
      <% end %>
    </li>
  <% end %>
</ol>

<!-- Step 2: Calculate and display the balances -->

<% accounts = Hash.new %>
<% for user in User.all %>
  <% user_id = user["id"] %>
  <% accounts[user_id] = 0 %>
<% end %>

<% for transaction in Transaction.all %>
  <% if !transaction["from_user_id"].nil? %>
    <% accounts[transaction["from_user_id"]] -= transaction["amount"] %>
  <% end %>

  <% accounts[transaction["to_user_id"]] += transaction["amount"] %>
<% end %>

Balances for each user:
<table>
  <tr>
    <th>Name</th>
    <th>Balance</th>
  </tr>
  <% accounts.each do |user_id, balance| %>
    <% acct = User.find_by({ "id" => user_id }) %>
    <tr>
      <td><%= acct["name"] %></td>
      <td><%= balance %> KC</td>
    </tr>
  <% end %>
</table>

<!-- 
Expected balances:
Balance for Brian: 1348 KC
Balance for Ben: 2516 KC
Balance for Evan: 1164 KC
Balance for Anthony: 1456 KC
Balance for Krystina: 3516 KC 
-->